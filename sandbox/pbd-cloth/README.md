# PBD Cloth Simulation

基于Position Based Dynamics (PBD)方法的实时布料模拟，使用OpenGL Compute Shader进行GPU加速计算。

## 功能特性

### 物理模拟
- **PBD算法**: 使用位置基动力学进行稳定的布料模拟
- **多种约束**: 
  - 结构约束 (水平和垂直连接)
  - 剪切约束 (对角线连接，防止布料过度拉伸)
  - 弯曲约束 (隔点连接，模拟布料的抗弯曲特性)
- **GPU加速**: 所有物理计算在GPU上并行执行
- **多迭代求解器**: 可调节约束求解迭代次数以提高稳定性

### 环境交互
- **重力模拟**: 可调节重力强度
- **风力效果**: 可开启/关闭风力，调节风力方向和强度
- **地面碰撞**: 简单的地面碰撞检测
- **固定点**: 支持固定布料的特定点（默认固定顶部两角）

### 渲染功能
- **三角面片渲染**: 完整的布料网格渲染
- **线框模式**: 可切换线框显示模式查看网格结构
- **粒子点显示**: 可显示布料粒子点
- **实时参数调节**: ImGui界面支持实时调节所有参数

## 控制说明

### 键盘控制
- `W/A/S/D` - 移动摄像机
- `Space` - 暂停/恢复模拟
- `Esc` - 退出程序

### 鼠标控制
- `鼠标中键拖拽` - 旋转视角

### UI参数
- **Cloth Settings**: 布料尺寸设置
- **Physics Settings**: 重力、阻尼、刚度、求解器迭代次数、时间步长
- **Wind Settings**: 风力开关和风力矢量
- **Rendering Settings**: 布料颜色、线框模式、点显示

## 技术实现

### PBD算法流程
1. **预测位置** (`predict-positions.comp`):
   - 应用重力和风力
   - 使用Verlet积分预测新位置
   - 处理地面碰撞
   - 应用速度阻尼

2. **约束满足** (`satisfy-constraints.comp`):
   - 并行处理所有约束
   - 计算约束误差并修正粒子位置
   - 支持多次迭代以提高稳定性

3. **位置更新** (`update-positions.comp`):
   - 根据位置变化更新速度
   - 为下一帧做准备

### 数据结构
```glsl
struct ClothParticle {
  vec4 position;      // 当前位置
  vec4 oldPosition;   // 上一帧位置
  vec4 velocity;      // 速度
  float mass;         // 质量
  float invMass;      // 逆质量 (0.0表示固定点)
};

struct Constraint {
  uint particleA;     // 粒子A索引
  uint particleB;     // 粒子B索引
  float restLength;   // 静止长度
  float stiffness;    // 约束刚度
};
```

### 性能优化
- GPU并行计算所有物理步骤
- 使用适当的线程组大小 (128)
- 内存访问模式优化
- 避免不必要的计算（固定粒子跳过）

## 编译和运行

确保项目根目录已正确配置所有依赖项（GLFW, GLAD, ImGui, GLM等），然后：

```bash
mkdir build
cd build
cmake ..
make pbd-cloth
./pbd-cloth
```

## 参数建议

### 稳定的默认设置
- 布料尺寸: 32x32
- 重力: -9.8
- 阻尼: 0.99
- 刚度: 1.0
- 求解器迭代: 3次
- 时间步长: 0.016 (60fps)

### 性能调优
- 较小的布料尺寸可以提高帧率
- 减少求解器迭代次数可以提高性能但降低稳定性
- 增加时间步长可以加快模拟但可能降低稳定性

## 扩展可能性

1. **碰撞检测**: 添加与其他物体的碰撞检测
2. **撕裂效果**: 实现布料撕裂机制
3. **改进光照**: 添加法线计算和更复杂的光照模型
4. **纹理映射**: 为布料添加纹理
5. **自碰撞**: 实现布料自身的碰撞检测
6. **多层布料**: 支持多层布料交互